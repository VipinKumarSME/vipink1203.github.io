<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>
    Python Script to Decrypt Encrypted File With AWS KMS - VIPIN KUMAR
    
  </title>

  <meta name="description" content="In this post, you will learn how to encrypt an SSH private key using KMS and how to use Python to decrypt the encrypted SSH key. This would be useful for the...">

  <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">

  <link rel="stylesheet" href="/assets/vendor/fontawesome-free/css/all.min.css">

  <link rel="stylesheet" href="/assets/main.css">
  
  <link rel="canonical" href="http://localhost:4000/scripting/2019/10/25/decrypt-kms-encrypted-file-using-python.html">
  <link rel="alternate" type="application/rss+xml" title="VIPIN KUMAR" href="/feed.xml">

</head>


<body>

  <!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-light fixed-top" id="mainNav">
  <div class="container">
    <a class="navbar-brand" href="/">VIPIN KUMAR</a>
    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      Menu
      <i class="fa fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarResponsive">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/posts">Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/contact">Contact</a>
        </li>
      </ul>
    </div>
  </div>
</nav>


  <!-- Page Header -->

  <header class="masthead">
    
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="post-heading">
            <h1>Python Script to Decrypt Encrypted File With AWS KMS</h1>
            
            <span class="meta">Posted by
              <a href="#">Vipin Kumar</a>
              on October 25, 2019 &middot; <span class="reading-time" title="Estimated read time">
  
   1 min  read </span>

            </span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">

        <p>In this post, you will learn how to encrypt an SSH private key using KMS and how to use Python to decrypt the encrypted SSH key. </p>
<p>This would be useful for the use cases such as when creating a Lambda function and you don't want to place the plain text SSH private key to do some operations on the server.</p>

<p>Let's begin..</p>

<h4>Step 1:</h4>
<p>Create a KMS key in your AWS account. It's pretty easy and you can use this <a href="https://docs.aws.amazon.com/kms/latest/developerguide/create-keys.html#create-keys-console">AWS Documentation</a> for reference.</p>

<h4>Step 2:</h4>
<p>Now you can use the aws-cli to encrypt the SSH private key as shown below.</p>

<p><div style="background-color:black;color:white;padding:10px;">
    # aws kms encrypt --key-id 7fmcesd6-c4ff-7b01-b11c-5h2e91h1b301 --plaintext fileb://privateKey.pem --output text --query CiphertextBlob | base64 --decode > EncryptedFile
</div></p>
<p>After you run this command, the encrypted text is stored to <b>EncryptedFile</b> file</p>

<h4>Step 3:</h4>
<p>You can find the python script <a href="https://github.com/vipink1203/Python-Scripts/blob/master/kms-decrypt.py">here</a>.</p>
<p>Place the EncryptedFile along with the python script and run it.</p>
<p>I used Python 3.5 version, didn't test with Python 2. Feel free to do so.</p>
<p>Will post another one where we will create a Lambda function to support this use case.</p>

        <hr>

        <div class="clearfix">

          
          <a class="btn btn-primary float-left" href="/cpanel/2019/10/16/list-php-handler-cpanel.html" data-toggle="tooltip" data-placement="top" title="List The Current PHP Handler - cPanel">&larr; Previous<span class="d-none d-md-inline">
              Post</span></a>
          
          

        </div>

      </div>
    </div>
  </div>

  <!-- Footer -->

<hr>

<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
        <ul class="list-inline text-center">
          
          <li class="list-inline-item">
            <a href="mailto:vipink1203@gmail.com">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="far fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://twitter.com/vipink1203">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          
          <li class="list-inline-item">
            <a href="https://www.linkedin.com/in/vipink1203">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
          
          <li class="list-inline-item">
            <a href="https://github.com/vipink1203">
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="copyright text-muted">Copyright &copy; Vipin Kumar 2019</p>
      </div>
    </div>
  </div>
</footer>


  <script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/assets/vendor/startbootstrap-clean-blog/js/clean-blog.min.js"></script>

<script src="/assets/scripts.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '');
</script>



</body>

</html>