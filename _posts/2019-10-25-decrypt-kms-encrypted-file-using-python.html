---
layout: post
title:  "Decrypt KMS Key Encrypted File Using Python"
date:   2019-10-25 1:33:40 +0530
categories: scripting
---

<p>In this post, you will learn how to encrypt an SSH private key using KMS and how to use Python to decrypt the encrypted SSH key. </p>
<p>This would be useful for the use cases such as when creating a Lambda function and you don't want to place the plain text SSH private key to do some operations on the server.</p>

<p>Let's begin..</p>

<h4>Step 1:</h4>
<p>Create a KMS key in your AWS account. It's pretty easy and you can use this <a href="https://docs.aws.amazon.com/kms/latest/developerguide/create-keys.html#create-keys-console">AWS Documentation</a> for reference.</p>

<h4>Step 2:</h4>
<p>Now you can use the aws-cli to encrypt the SSH private key as shown below.</p>

<p><div style="background-color:black;color:white;padding:10px;">
    # aws kms encrypt --key-id 7fmcesd6-c4ff-7b01-b11c-5h2e91h1b301 --plaintext fileb://privateKey.pem --output text --query CiphertextBlob | base64 --decode > EncryptedFile
</div></p>
<p>After you run this command, the encrypted text is stored to <b>EncryptedFile</b> file</p>

<h4>Step 3:</h4>
<p>You can find the python script <a href="https://github.com/vipink1203/Python-Scripts/blob/master/kms-decrypt.py">here</a>.</p>
<p>Place the EncryptedFile along with the python script and run it.</p>
<p>I used Python 3.5 version, didn't test with Python 2. Feel free to do so.</p>
<p>Will post another one where we will create a Lambda function to support this use case.</p>